<h2>My Requests</h2>

<!-- New: Status Filter -->
<div>
    <div class="filters-row">
        <div class="status-filter">
            <label>Filter by Status:</label>
            <select [(ngModel)]="selectedStatus" (change)="onFilterChange()">
            <option value="">All Statuses</option>
            <option value="PENDING">Pending</option>
            <option value="APPROVED">Approved</option>
            <option value="REJECTED">Rejected</option>
        </select>
        </div>
    </div>

    @if (filteredRequests.length === 0) {
    <p class="no-requests">No requests match the selected filter.</p>
    } @else {
    <div class="requests-list">
        @for (item of filteredRequests; track item.id) {
        <div class="request-card">

            @if (editingId !== item.id) {
            <h3>{{ item.name }}</h3>
            <p><strong>Category:</strong> {{ item.category }}</p>
            <p><strong>Description:</strong> {{ item.description }}</p>
            <p><strong>Address:</strong> {{ item.address }}</p>
            <p><strong>Status:</strong>
                <span class="status-badge" [class]="getStatusClass(item.status)">
              {{ item.status }}
            </span>
            </p>
            <p><strong>Comments:</strong> {{ item.comments || 'None' }}</p>

            <!-- Documents section remains unchanged -->
            <div class="documents-section">
                <h4>Documents:</h4>

                @if (item.documents && item.documents.length > 0) {
                <ul class="file-list">
                    @for (doc of item.documents; track $index) {
                    <li>
                        <a [href]="getDownloadUrl(item.id, $index)" target="_blank" download>
                        {{ getFileName(doc) }}
                    </a> @if (item.status === 'PENDING') {
                        <button type="button" (click)="deleteFile(item.id, $index)" class="remove-btn">
                            × Remove
                        </button> }
                    </li>
                    }
                </ul>
                } @else {
                <p>No documents uploaded.</p>
                }

                <!-- File upload area – only when PENDING -->
                @if (item.status === 'PENDING') {
                <div class="add-files">
                    <label>Ajouter des documents supplémentaires :</label>

                    <label class="custom-file-upload" for="file-input-{{item.id}}">
                Choisir des fichiers
            </label>

                    <input id="file-input-{{item.id}}" type="file" multiple (change)="onAdditionalFilesChange($event, item.id)" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" hidden> @let files = additionalFiles[item.id];

                    <p class="upload-hint">
                        @if (files && files.length > 0) { {{ files.length }} fichier(s) sélectionné(s) } @else { Aucun fichier choisi }
                    </p>

                    <button type="button" (click)="uploadAdditionalFiles(item.id)" [disabled]="!files || files.length === 0" class="upload-action-btn">
                Téléverser
            </button>
                </div>
                }
            </div>


            <div class="action-buttons">
                @if (item.status === 'PENDING') {
                <button class="edit" (click)="startEdit(item)">Edit</button> } @if (item.status === 'PENDING' || item.status === 'REJECTED') {
                <button class="delete" (click)="delete(item.id)">Delete</button> }
            </div>

            } @else { ... edit form ... }
        </div>
        }
    </div>
    }
</div>