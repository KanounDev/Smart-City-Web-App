<h2>Admin Panel</h2>

<!-- New: Tabs -->
<div class="tabs">
    <button [class.active]="activeTab === 'pending'" (click)="setTab('pending')">Pending Requests</button>
    <button [class.active]="activeTab === 'approved'" (click)="setTab('approved')">Approved History</button>
    <button [class.active]="activeTab === 'rejected'" (click)="setTab('rejected')">Rejected History</button>
    <button [class.active]="activeTab === 'categories'" (click)="setTab('categories')">Manage Categories</button>
</div>

<!-- Tab Content -->
@if (activeTab === 'pending') {
<div class="tab-content">
    @if (pendingRequests.length === 0) {
    <p class="no-requests">No pending requests.</p>
    } @else {
    <div class="requests-list">
        @for (item of pendingRequests; track item.id) {
        <div class="request-card">
            <h3>{{ item.name }}</h3>
            <p><strong>Category:</strong> {{ item.category }}</p>
            <p><strong>Description:</strong> {{ item.description }}</p>
            <p><strong>Address:</strong> {{ item.address }}</p>
            <p><strong>Status:</strong> <span class="status-badge" [class]="getStatusClass(item.status)">{{ item.status }}</span></p>
            <p><strong>Comments:</strong> {{ item.comments || 'None' }}</p>

            <div class="documents-section">
                <h4>Documents:</h4>
                @if (item.documents && item.documents.length > 0) {
                <ul class="file-list">
                    @for (doc of item.documents; track $index) {
                    <li><a [href]="getDownloadUrl(item.id, $index)" target="_blank" download>{{ getFileName(doc) }}</a></li>
                    }
                </ul>
                } @else {
                <p>No documents uploaded.</p>
                }
            </div>

            <div class="action-bar">
                <input type="text" placeholder="Admin Comments (e.g., request more docs)" #comments>
                <input type="number" placeholder="Lat" #lat>
                <input type="number" placeholder="Lng" #lng>
                <button class="approve" (click)="update(item.id, 'APPROVED', comments.value, lat.valueAsNumber, lng.valueAsNumber)">Approve</button>
                <button class="reject" (click)="update(item.id, 'REJECTED', comments.value, null, null)">Reject</button>
            </div>
        </div>
        }
    </div>
    }
</div>
} @if (activeTab === 'approved') {
<div class="tab-content">
    @if (approvedRequests.length === 0) {
    <p class="no-requests">No approved requests.</p>
    } @else {
    <div class="requests-list">
        @for (item of approvedRequests; track item.id) {
        <div class="request-card view-only">
            <!-- Similar to pending, but no actions -->
            <h3>{{ item.name }}</h3>
            <p><strong>Category:</strong> {{ item.category }}</p>
            <p><strong>Description:</strong> {{ item.description }}</p>
            <p><strong>Address:</strong> {{ item.address }}</p>
            <p><strong>Status:</strong> <span class="status-badge" [class]="getStatusClass(item.status)">{{ item.status }}</span></p>
            <p><strong>Comments:</strong> {{ item.comments || 'None' }}</p>
            <p><strong>Location:</strong> Lat: {{ item.lat }}, Lng: {{ item.lng }}</p>

            <div class="documents-section">
                <h4>Documents:</h4>
                @if (item.documents && item.documents.length > 0) {
                <ul class="file-list">
                    @for (doc of item.documents; track $index) {
                    <li><a [href]="getDownloadUrl(item.id, $index)" target="_blank" download>{{ getFileName(doc) }}</a></li>
                    }
                </ul>
                } @else {
                <p>No documents uploaded.</p>
                }
            </div>
        </div>
        }
    </div>
    }
</div>
} @if (activeTab === 'rejected') {
<div class="tab-content">
    @if (rejectedRequests.length === 0) {
    <p class="no-requests">No rejected requests.</p>
    } @else {
    <div class="requests-list">
        @for (item of rejectedRequests; track item.id) {
        <div class="request-card view-only">
            <!-- Similar to approved -->
            <h3>{{ item.name }}</h3>
            <p><strong>Category:</strong> {{ item.category }}</p>
            <p><strong>Description:</strong> {{ item.description }}</p>
            <p><strong>Address:</strong> {{ item.address }}</p>
            <p><strong>Status:</strong> <span class="status-badge" [class]="getStatusClass(item.status)">{{ item.status }}</span></p>
            <p><strong>Comments:</strong> {{ item.comments || 'None' }}</p>

            <div class="documents-section">
                <h4>Documents:</h4>
                @if (item.documents && item.documents.length > 0) {
                <ul class="file-list">
                    @for (doc of item.documents; track $index) {
                    <li><a [href]="getDownloadUrl(item.id, $index)" target="_blank" download>{{ getFileName(doc) }}</a></li>
                    }
                </ul>
                } @else {
                <p>No documents uploaded.</p>
                }
            </div>
        </div>
        }
    </div>
    }
</div>
} @if (activeTab === 'categories') {
<div class="tab-content categories-management">
    <h3>Manage Categories</h3>
    <div class="add-category">
        <input type="text" [(ngModel)]="newCategory" placeholder="New category name">
        <button (click)="addCategory()">Add</button>
    </div>

    @if (categories.length === 0) {
    <p>No categories yet.</p>
    } @else {
    <ul class="categories-list">
        @for (cat of categories; track $index) {
        <li>
            @if (editingCategoryIndex !== $index) {
            <span>{{ cat }}</span>
            <button (click)="editCategory($index)">Edit</button>
            <button class="delete" (click)="deleteCategory($index)">Delete</button> } @else {
            <input type="text" [(ngModel)]="editCategoryValue" placeholder="Edit name">
            <button (click)="saveCategory($index)">Save</button>
            <button (click)="cancelEdit()">Cancel</button> }
        </li>
        }
    </ul>
    }
</div>
}