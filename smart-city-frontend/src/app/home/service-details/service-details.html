<!-- Updated service-details.html with loading state and ngIf checks -->

<div class="details-container" *ngIf="!isLoading; else loadingTemplate">
    <!-- Added *ngIf for loading -->

    <div class="shop-header" *ngIf="shop.name">
        <!-- Safeguard if shop is empty -->
        <h1>{{ shop.name }}</h1>
        <p class="category">{{ shop.category }}</p>
        <p class="address"><strong>Address:</strong> {{ shop.address }}</p>
        <p class="description">{{ shop.description }}</p>
    </div>

    <!-- Simple tabs simulation with sections -->
    <div class="sections">

        <!-- Services Offered -->
        <section class="section services">
            <h2>Services / Products Offered</h2>
            @if (services.length === 0) {
            <p>No services listed yet.</p>
            } @else {
            <ul class="services-list">
                @for (service of services; track $index) {
                <li class="service-item">
                    <strong>{{ service.name }}</strong>
                    <p>{{ service.description }}</p>
                    <span class="price">{{ service.price }}</span>
                </li>
                }
            </ul>
            }
        </section>

        <!-- Reviews -->
        <section class="section reviews">
            <h2>Reviews</h2>

            <!-- Review Form -->
            <div class="review-form">
                <select [(ngModel)]="newReview.rating" required>
                    <option value="" disabled selected>Select rating (1-5)</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
                <textarea [(ngModel)]="newReview.comment" placeholder="Write your review..." rows="4" required></textarea>
                <button (click)="submitReview()" [disabled]="!newReview.comment || !newReview.rating">Submit Review</button>
            </div>

            @if (reviews.length === 0) {
            <p class="no-reviews">No reviews yet. Be the first!</p>
            } @else {
            <div class="reviews-list">
                @for (review of reviews; track $index) {
                <div class="review-card">
                    <div class="review-header">
                        <strong>{{ review.userId }}</strong>
                        <!-- Treating userId as username -->
                        <span class="rating">{{ review.rating }} / 5</span>
                        <span class="date">{{ review.date | date:'medium' }}</span>
                    </div>
                    <p>{{ review.comment }}</p>
                </div>
                }
            </div>
            }
        </section>
    </div>
</div>

<ng-template #loadingTemplate>
    <div class="loading-state">
        <p>Loading business details...</p>
    </div>
</ng-template>